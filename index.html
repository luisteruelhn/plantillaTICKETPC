<script>
  const params = new URLSearchParams(window.location.search);
  const campos = [
    "FECHA_RECEPCION","IDTALLERPC","IDxORDENPC",
    "NOMBRECLIENTE","TELCLIENTE","DIRCLIENTE",
    "RECIBIDO_POR","EQUIPOX","MARCA","INFO1","INFO2",
    "SERVICIOREQUERIDO","SERVICIOREALIZADO",
    "ESTADO","COSTOLPS","CONFORME","TEXTOCONFORME","_qr",
    "CLAVE","GARANTIA"
  ];

  campos.forEach(c => {
    const valor = params.get(c);
    if (valor) {
      const el = document.getElementById(c);
      if (el) {
        if (c === "_qr") {
          // Cargar imagen QR din√°mica
          el.src = decodeURIComponent(valor);
          el.alt = "QR del equipo";
          el.style.display = "block";
        } else if (c === "COSTOLPS") {
          // üëâ Formatear costo con dos decimales
          const num = parseFloat(valor);
          if (!isNaN(num)) {
            el.textContent = num.toFixed(2); // 100 ‚Üí 100.00
          } else {
            el.textContent = decodeURIComponent(valor);
          }
        } else {
          el.textContent = decodeURIComponent(valor);
        }
      }
    }
  });

  // --- Mostrar la firma (CONFORME) solo si existe ---
  const firmaParam = params.get("CONFORME");
  const imgFirma = document.getElementById("CONFORME_IMG");
  if (imgFirma) {
    if (firmaParam && firmaParam.trim() !== "") {
      let firmaURL = decodeURIComponent(firmaParam);

      // Si la URL es una ruta interna de AppSheet, convertirla en una URL p√∫blica
      if (firmaURL.startsWith("PC_Images/")) {
        firmaURL =
          "https://www.appsheet.com/template/gettablefileurl?" +
          "appName=TYTOneDBA-909404411" +
          "&tableName=PC" +
          "&fileName=" + encodeURIComponent(firmaURL);
      }

      imgFirma.src = firmaURL;
      imgFirma.style.display = "block";
    } else {
      imgFirma.style.display = "none";
    }
  }

  // --- Control de modo de impresi√≥n ---
  const modo = params.get("modo");

  if (modo === "corto") {
    // Oculta secciones que no deben verse en el ticket corto
    const ocultar = [
      "SERVICIOREALIZADO", // texto largo del trabajo
      "CONFORME_IMG",
      "TEXTOCONFORME",
      "seccionConforme",
      "qr-full" // QR de WhatsApp
    ];

    ocultar.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    });

    // Tambi√©n puedes ocultar el pie de p√°gina si existe
    const pie = document.querySelector(".whatsapp");
    if (pie) pie.style.display = "none";
  }

  // --- Mostrar PW y Garant√≠a en modo corto ---
  const pwInfo = document.getElementById("pwInfo");
  if (pwInfo) pwInfo.style.display = "block";
</script>
